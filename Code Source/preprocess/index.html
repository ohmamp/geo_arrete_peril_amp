<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Preprocess - Geo Arrêtés</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Preprocess";
        var mkdocs_page_input_path = "Code Source\\preprocess.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Geo Arrêtés
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Index</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../install/">Guide d'installation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Code Source</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../domain_knowledge/">Domain Knowledge</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Preprocess</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#convertir-les-fichiers-pdf-natifs-en-pdfa">Convertir les fichiers PDF natifs en PDF/A</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.convert_native_pdf_to_pdfa">convert_native_pdf_to_pdfa</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.convert_native_pdf_to_pdfa.process_files">process_files()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#convertir-un-fichier-pdf-en-pdfa-archivable">Convertir un fichier PDF en PDF/A (archivable)</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.convert_to_pdfa">convert_to_pdfa</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.convert_to_pdfa.convert_pdf_to_pdfa">convert_pdf_to_pdfa()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sources-de-donnees">Sources de données</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.data_sources">data_sources</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#determiner-le-type-des-fichiers-pdf">Déterminer le type des fichiers PDF</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.determine_pdf_type">determine_pdf_type</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.determine_pdf_type.guess_pdf_type">guess_pdf_type()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.determine_pdf_type.process_files">process_files()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#extrait-le-texte-natif-des-fichiers-pdf-avec-pdfminersix">Extrait le texte natif des fichiers PDF avec pdfminer.six</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_native_text_pdfminer">extract_native_text_pdfminer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_native_text_pdfminer.extract_native_text_pdfminer">extract_native_text_pdfminer()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#extrait-le-texte-natif-des-fichiers-pdf-avec-pdftotext">Extrait le texte natif des fichiers PDF avec pdftotext</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_native_text_pdftotext">extract_native_text_pdftotext</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_native_text_pdftotext.extract_native_text_pdftotext">extract_native_text_pdftotext()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#extraire-le-texte-natif-des-fichiers-pdf">Extraire le texte natif des fichiers PDF</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_native_text">extract_native_text</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_native_text.extract_native_text">extract_native_text()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_native_text.process_files">process_files()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#extraire-le-texte-de-fichiers-pdf-par-ocr">Extraire le texte de fichiers PDF par OCR</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_text_ocr_ocrmypdf">extract_text_ocr_ocrmypdf</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_text_ocr_ocrmypdf.extract_text_from_pdf_image">extract_text_from_pdf_image()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_text_ocr">extract_text_ocr</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_text_ocr.preprocess_pdf_file">preprocess_pdf_file()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.extract_text_ocr.process_files">process_files()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#filtrer-les-fichiers-pdf-hors-du-champ-de-la-base-de-donnees">Filtrer les fichiers PDF hors du champ de la base de données</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.filter_docs">filter_docs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.filter_docs.process_files">process_files()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#indexer-un-ensemble-de-fichiers-pdf">Indexer un ensemble de fichiers PDF</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.index_pdfs">index_pdfs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.index_pdfs.index_folder">index_folder()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#extraire-les-metadonnees-des-fichiers-pdf">Extraire les métadonnées des fichiers PDF</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.pdf_info">pdf_info</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.pdf_info.get_pdf_info">get_pdf_info()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.pdf_info.get_pdf_info_pikepdf">get_pdf_info_pikepdf()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#traiter-les-metadonnees-des-fichiers-pdf">Traiter les métadonnées des fichiers PDF</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.process_metadata">process_metadata</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.process_metadata.guess_badocr">guess_badocr()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.process_metadata.guess_dernpage_transmission">guess_dernpage_transmission()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.process_metadata.guess_duplicates_meta">guess_duplicates_meta()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.process_metadata.guess_pdftext">guess_pdftext()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.process_metadata.guess_tampon_transmission">guess_tampon_transmission()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#charge-le-texte-des-documents-dans-un-dataframe">Charge le texte des documents dans un DataFrame</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.separate_pages">separate_pages</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#src.preprocess.separate_pages.create_pages_dataframe">create_pages_dataframe()</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../process/">Process</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quality/">Quality</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../utils/">Utils</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Notebooks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../Notebooks/notebooks/">Notebooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Scripts</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../Scripts/scripts/">Scripts</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Geo Arrêtés</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Code Source</li>
      <li class="breadcrumb-item active">Preprocess</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="preprocess">Preprocess</h1>
<p>Fonctions de prétraitements des fichiers PDFs.</p>
<h2 id="convertir-les-fichiers-pdf-natifs-en-pdfa">Convertir les fichiers PDF natifs en PDF/A</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.convert_native_pdf_to_pdfa"></a>
  <div class="doc doc-contents first">
  
      <p>Utilise ocrmypdf sans appeler le moteur d'OCR.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.convert_native_pdf_to_pdfa.process_files" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_files</span><span class="p">(</span><span class="n">df_meta</span><span class="p">,</span> <span class="n">out_pdf_dir</span><span class="p">,</span> <span class="n">redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keep_pdfa</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convertir les fichiers PDF natifs en PDF/A.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Liste de fichiers PDF à traiter, avec leurs métadonnées.</p>
              </div>
            </li>
            <li>
              <b><code>out_pdf_dir</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Dossier de sortie pour les PDF/A.</p>
              </div>
            </li>
            <li>
              <b><code>redo</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, réanalyse les fichiers déjà traités.</p>
              </div>
            </li>
            <li>
              <b><code>keep_pdfa</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, n'efface pas les fichiers PDF générés par l'OCR.</p>
              </div>
            </li>
            <li>
              <b><code>verbose</code></b>
                  (<code>int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>Niveau de verbosité d'ocrmypdf (-1, 0, 1, 2):
<a href="https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity">https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity</a></p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Métadonnées des fichiers d'entrée et chemins vers les fichiers PDF/A.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="convertir-un-fichier-pdf-en-pdfa-archivable">Convertir un fichier PDF en PDF/A (archivable)</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.convert_to_pdfa"></a>
  <div class="doc doc-contents first">
  
      <p>Utilise ocrmypdf.</p>
<p>NB: Certaines métadonnées du PDF sont perdues
<a href="https://github.com/ocrmypdf/OCRmyPDF/issues/327">https://github.com/ocrmypdf/OCRmyPDF/issues/327</a>.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.convert_to_pdfa.convert_pdf_to_pdfa" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">convert_pdf_to_pdfa</span><span class="p">(</span><span class="n">fp_pdf_in</span><span class="p">,</span> <span class="n">fp_pdf_out</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convertir un PDF en PDF/A.</p>
<p>Utilise ocrmypdf sans appliquer d'OCR.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>verbose</code></b>
                  (<code>int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>Niveau de verbosité d'ocrmypdf (-1, 0, 1, 2):
<a href="https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity">https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity</a></p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>returncode</code></b>(                <code>int</code>
)            –
            <div class="doc-md-description">
              <p>0 si un fichier PDF/A a été produit, 1 sinon.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="sources-de-donnees">Sources de données</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.data_sources"></a>
  <div class="doc doc-contents first">
  
      

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h2 id="determiner-le-type-des-fichiers-pdf">Déterminer le type des fichiers PDF</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.determine_pdf_type"></a>
  <div class="doc doc-contents first">
  
      <p>Un fichier peut être considéré PDF natif ("texte")
ou non ("image").</p>
<p>Le type est déterminé pour le fichier entier, sans
rentrer dans les cas particuliers commme un PDF texte
dans lequel une page numérisée a été insérée en tant
qu'image.
Actuellement, de tels fichiers sont probablement
considérés comme des fichiers PDF non natifs ("image"),
en se basant sur les métadonnées du fichier PDF.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.determine_pdf_type.guess_pdf_type" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">guess_pdf_type</span><span class="p">(</span><span class="n">df_row</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Devine le type de PDF: natif ("texte") ou non ("image")</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_row</code></b>
                  (<code><span title="typing.NamedTuple">NamedTuple</span></code>)
              –
              <div class="doc-md-description">
                <p>Métadonnées et propriétés du fichier PDF.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>pdf_type</code></b>(                <code>string, one of {&#34;text&#34;, &#34;image&#34;}</code>
)            –
            <div class="doc-md-description">
              <p>Type de PDF: "text" pour les PDF natifs, "image" pour les autres
qui devront être OCRisés.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.preprocess.determine_pdf_type.process_files" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_files</span><span class="p">(</span><span class="n">df_meta</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Déterminer le type des fichiers PDF.</p>
<p>Un fichier PDF peut être natif ("texte") ou non ("image").</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Liste de fichiers PDF à traiter, avec leurs métadonnées.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Métadonnées des fichiers d'entrée et chemins vers les fichiers PDF/A et TXT.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="extrait-le-texte-natif-des-fichiers-pdf-avec-pdfminersix">Extrait le texte natif des fichiers PDF avec pdfminer.six</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.extract_native_text_pdfminer"></a>
  <div class="doc doc-contents first">
  
      <p>Nécessite d'installer pdfminer.six.</p>
<p>Non utilisé pour le moment, faute d'avoir identifié les bonnes valeurs des paramètres
utilisés pour l'analyse du layout, mais pourrait être utile pour ré-analyser les
arrêtés de certaines communes avec une mise en page compliquée.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.extract_native_text_pdfminer.extract_native_text_pdfminer" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">extract_native_text_pdfminer</span><span class="p">(</span><span class="n">fp_pdf_in</span><span class="p">,</span> <span class="n">fp_txt_out</span><span class="p">,</span> <span class="n">page_beg</span><span class="p">,</span> <span class="n">page_end</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extrait le texte natif d'un PDF avec pdfminer.six.</p>
<p>Si le texte extrait par pdfminer.six n'est pas vide alors un fichier TXT est produit,
sinon aucun fichier TXT n'est produit et un code d'erreur est renvoyé.</p>
<p>Les pages sont séparées par un "form feed" ("", "" en python).</p>
<p>Le texte est normalisé en forme NFC (NEW 2023-03-10, NFC plutôt que NFKC car ce dernier transforme "º" en "o").</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fp_pdf_in</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Fichier PDF d'entrée.</p>
              </div>
            </li>
            <li>
              <b><code>fp_txt_out</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Fichier TXT produit par extraction directe du texte.</p>
              </div>
            </li>
            <li>
              <b><code>page_beg</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>Numéro de la première page à traiter, la première page d'un PDF est supposée numérotée 1.</p>
              </div>
            </li>
            <li>
              <b><code>page_end</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>Numéro de la dernière page à traiter (cette page étant incluse).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>returncode</code></b>(                <code>int</code>
)            –
            <div class="doc-md-description">
              <p>0 si un fichier TXT a été produit, 1 sinon.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="extrait-le-texte-natif-des-fichiers-pdf-avec-pdftotext">Extrait le texte natif des fichiers PDF avec pdftotext</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.extract_native_text_pdftotext"></a>
  <div class="doc doc-contents first">
  
      <p><a href="https://github.com/jalan/pdftotext">https://github.com/jalan/pdftotext</a></p>
<p>Dépendances Windows (<a href="https://github.com/jalan/pdftotext#os-dependencies">https://github.com/jalan/pdftotext#os-dependencies</a>):
* Microsoft Visual C++ Build Tools: <a href="https://visualstudio.microsoft.com/fr/visual-cpp-build-tools/">https://visualstudio.microsoft.com/fr/visual-cpp-build-tools/</a>
* poppler ( <code>conda install -c conda-forge poppler</code> )</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.extract_native_text_pdftotext.extract_native_text_pdftotext" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">extract_native_text_pdftotext</span><span class="p">(</span><span class="n">fp_pdf_in</span><span class="p">,</span> <span class="n">fp_txt_out</span><span class="p">,</span> <span class="n">page_beg</span><span class="p">,</span> <span class="n">page_end</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extrait le texte natif d'un PDF avec pdftotext.</p>
<p>Si le texte extrait par pdftotext n'est pas vide alors un fichier TXT est produit,
sinon aucun fichier TXT n'est produit et un code d'erreur est renvoyé.</p>
<p>Les pages sont séparées par un "form feed" ("", "" en python).</p>
<p>Le texte est normalisé en forme NFC (NEW 2023-03-10, NFC plutôt que NFKC car ce dernier transforme "º" en "o").</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fp_pdf_in</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Fichier PDF d'entrée.</p>
              </div>
            </li>
            <li>
              <b><code>fp_txt_out</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Fichier TXT produit par extraction directe du texte.</p>
              </div>
            </li>
            <li>
              <b><code>page_beg</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>Numéro de la première page à traiter, la première page d'un PDF est supposée numérotée 1.</p>
              </div>
            </li>
            <li>
              <b><code>page_end</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>Numéro de la dernière page à traiter (cette page étant incluse).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>returncode</code></b>(                <code>int</code>
)            –
            <div class="doc-md-description">
              <p>0 si un fichier TXT a été produit, 1 sinon.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="extraire-le-texte-natif-des-fichiers-pdf">Extraire le texte natif des fichiers PDF</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.extract_native_text"></a>
  <div class="doc doc-contents first">
  
      <p>Le texte natif est extrait avec le wrapper python de l'utilitaire "pdftotext" de poppler.</p>
<p>Le texte natif représente:
* pour les PDF natifs ("PDF texte"), l'intégralité du texte ;
* pour les PDF non-natifs ("PDF image"), du texte extrait par OCR (de qualité variable)
ou des fragments de texte issus d'ajout d'objets natifs, eg. tampon, accusé de réception.</p>
<p>Le texte est normalisé en forme NFC: <a href="https://docs.python.org/3/howto/unicode.html#comparing-strings">https://docs.python.org/3/howto/unicode.html#comparing-strings</a>.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.extract_native_text.extract_native_text" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">extract_native_text</span><span class="p">(</span><span class="n">df_row</span><span class="p">,</span> <span class="n">fp_pdf_in</span><span class="p">,</span> <span class="n">fp_txt_out</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extrait le texte natif d'un PDF.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_row</code></b>
                  (<code><span title="typing.NamedTuple">NamedTuple</span></code>)
              –
              <div class="doc-md-description">
                <p>Métadonnées et informations sur le fichier PDF à traiter.</p>
              </div>
            </li>
            <li>
              <b><code>fp_pdf_in</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Chemin du fichier PDF à traiter.</p>
              </div>
            </li>
            <li>
              <b><code>fp_txt_out</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Chemin du fichier txt contenant le texte extrait.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>returncode</code></b>(                <code>int</code>
)            –
            <div class="doc-md-description">
              <p>Code de retour de l'extraction: 0 si un fichier TXT a été produit, 1 sinon.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.preprocess.extract_native_text.process_files" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_files</span><span class="p">(</span><span class="n">df_meta</span><span class="p">,</span> <span class="n">out_dir_txt</span><span class="p">,</span> <span class="n">redo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Traiter un ensemble de fichiers PDF: convertir les PDF en PDF/A et extraire le texte.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Liste de fichiers PDF à traiter, avec leurs métadonnées.</p>
              </div>
            </li>
            <li>
              <b><code>out_dir_txt</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Dossier de sortie pour les fichiers texte.</p>
              </div>
            </li>
            <li>
              <b><code>redo</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, réanalyse les fichiers déjà traités.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Métadonnées des fichiers d'entrée, chemins vers les fichiers TXT produits et codes
de retour de l'extraction de texte natif.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="extraire-le-texte-de-fichiers-pdf-par-ocr">Extraire le texte de fichiers PDF par OCR</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.extract_text_ocr_ocrmypdf"></a>
  <div class="doc doc-contents first">
  
      <p>Utilise ocrmypdf.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.extract_text_ocr_ocrmypdf.extract_text_from_pdf_image" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">extract_text_from_pdf_image</span><span class="p">(</span><span class="n">fp_pdf_in</span><span class="p">,</span> <span class="n">fp_txt_out</span><span class="p">,</span> <span class="n">fp_pdf_out</span><span class="p">,</span> <span class="n">page_beg</span><span class="p">,</span> <span class="n">page_end</span><span class="p">,</span> <span class="n">redo_ocr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extraire le texte d'un PDF image et convertir le fichier en PDF/A.</p>
<p>Utilise ocrmypdf.
On utilise "-l fra" pour améliorer la reconnaissance de: "à", "è",
"ê", apostrophe, "l'", "œ", "ô" etc.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fp_pdf_in</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Fichier PDF image à traiter.</p>
              </div>
            </li>
            <li>
              <b><code>fp_txt_out</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Fichier TXT produit, contenant le texte extrait par OCR.</p>
              </div>
            </li>
            <li>
              <b><code>fp_pdf_out</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Fichier PDF/A produit, incluant le texte océrisé.</p>
              </div>
            </li>
            <li>
              <b><code>page_beg</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>Numéro de la première page à traiter, la première page d'un PDF est supposée numérotée 1.</p>
              </div>
            </li>
            <li>
              <b><code>page_end</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>Numéro de la dernière page à traiter (cette page étant incluse).</p>
              </div>
            </li>
            <li>
              <b><code>redo_ocr</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, refait l'OCR même si une couche d'OCR est détectée sur certaines pages.</p>
              </div>
            </li>
            <li>
              <b><code>verbose</code></b>
                  (<code>int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>Niveau de verbosité d'ocrmypdf (-1, 0, 1, 2):
<a href="https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity">https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity</a></p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>returncode</code></b>(                <code>int</code>
)            –
            <div class="doc-md-description">
              <p>0 si deux fichiers PDF/A et TXT ont été produits, une autre valeur sinon
<a href="https://ocrmypdf.readthedocs.io/en/latest/advanced.html#return-code-policy">https://ocrmypdf.readthedocs.io/en/latest/advanced.html#return-code-policy</a> .</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="src.preprocess.extract_text_ocr"></a>
  <div class="doc doc-contents first">
  
      <p>Le texte des PDF non-natifs ("PDF image") est extrait avec ocrmypdf.</p>
<p>ocrmypdf produit un fichier PDF/A incluant une couche de texte extrait par OCR,
et un fichier "sidecar" contenant le texte extrait par l'OCR uniquement.</p>
<p>Le fichier PDF/A est effacé, sauf mention contraire explicite par l'option
"keep_pdfa".</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.extract_text_ocr.preprocess_pdf_file" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">preprocess_pdf_file</span><span class="p">(</span><span class="n">df_row</span><span class="p">,</span> <span class="n">fp_pdf_in</span><span class="p">,</span> <span class="n">fp_pdf_out</span><span class="p">,</span> <span class="n">fp_txt_out</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extraire le texte par OCR et générer des fichiers PDF/A et txt.</p>
<p>Le fichier PDF est OCRisé avec ocrmypdf, qui crée un PDF/A et un
fichier texte "sidecar".</p>
<p>La version actuelle est: ocrmypdf 14.0.3 / Tesseract OCR-PDF 5.2.0
(+ pikepdf 5.6.1).</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_row</code></b>
                  (<code><span title="typing.NamedTuple">NamedTuple</span></code>)
              –
              <div class="doc-md-description">
                <p>Métadonnées et informations sur le fichier PDF à traiter.</p>
              </div>
            </li>
            <li>
              <b><code>fp_pdf_in</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Chemin du fichier PDF à traiter.</p>
              </div>
            </li>
            <li>
              <b><code>fp_pdf_out</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Chemin du fichier PDF converti en PDF/A (avec OCR le cas échéant).</p>
              </div>
            </li>
            <li>
              <b><code>fp_txt_out</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Chemin du fichier txt contenant le texte extrait.</p>
              </div>
            </li>
            <li>
              <b><code>verbose</code></b>
                  (<code>int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>Niveau de verbosité d'ocrmypdf (-1, 0, 1, 2):
<a href="https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity">https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity</a></p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>retcode</code></b>(                <code>int</code>
)            –
            <div class="doc-md-description">
              <p>Code de retour d'ocrmypdf
<a href="https://ocrmypdf.readthedocs.io/en/latest/advanced.html#return-code-policy">https://ocrmypdf.readthedocs.io/en/latest/advanced.html#return-code-policy</a> .</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.preprocess.extract_text_ocr.process_files" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_files</span><span class="p">(</span><span class="n">df_meta</span><span class="p">,</span> <span class="n">out_pdf_dir</span><span class="p">,</span> <span class="n">out_txt_dir</span><span class="p">,</span> <span class="n">redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keep_pdfa</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Traiter un ensemble de fichiers PDF: convertir les PDF en PDF/A et extraire le texte.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Liste de fichiers PDF à traiter, avec leurs métadonnées.</p>
              </div>
            </li>
            <li>
              <b><code>out_pdf_dir</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Dossier de sortie pour les PDF/A.</p>
              </div>
            </li>
            <li>
              <b><code>out_txt_dir</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Dossier de sortie pour les fichiers texte.</p>
              </div>
            </li>
            <li>
              <b><code>redo</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, réanalyse les fichiers déjà traités.</p>
              </div>
            </li>
            <li>
              <b><code>keep_pdfa</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, n'efface pas les fichiers PDF générés par l'OCR.</p>
              </div>
            </li>
            <li>
              <b><code>verbose</code></b>
                  (<code>int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>Niveau de verbosité d'ocrmypdf (-1, 0, 1, 2):
<a href="https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity">https://ocrmypdf.readthedocs.io/en/latest/api.html#ocrmypdf.Verbosity</a></p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Métadonnées des fichiers d'entrée et chemins vers les fichiers PDF/A et TXT.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="filtrer-les-fichiers-pdf-hors-du-champ-de-la-base-de-donnees">Filtrer les fichiers PDF hors du champ de la base de données</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.filter_docs"></a>
  <div class="doc doc-contents first">
  
      <p>Annexes des arrêtés: plan de périmètre de sécurité, rapports d'expertise etc.</p>
<p>TODO filtrer automatiquement à partir du texte</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.filter_docs.process_files" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_files</span><span class="p">(</span><span class="n">df_meta</span><span class="p">,</span> <span class="n">df_txts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Traiter un ensemble d'arrêtés: repérer des éléments de structure des textes.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Liste de métadonnées des fichiers à traiter.</p>
              </div>
            </li>
            <li>
              <b><code>df_txts</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Liste de pages de documents à traiter.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Liste de métadonnées des fichiers, filtrés.</p>
            </div>
          </li>
          <li>
<b><code>df_tmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Liste de métadonnées des pages traitées, avec indications des éléments de
structure détectés.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="indexer-un-ensemble-de-fichiers-pdf">Indexer un ensemble de fichiers PDF</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.index_pdfs"></a>
  <div class="doc doc-contents first">
  
      <p>Calcule le hachage de chaque fichier et crée une copie
du fichier dans un dossier de travail, en faisant précéder
le nom du fichier par son hachage.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.index_pdfs.index_folder" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">index_folder</span><span class="p">(</span><span class="n">in_dir</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">index_csv</span><span class="p">,</span> <span class="n">new_csv</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">digest</span><span class="o">=</span><span class="s1">&#39;blake2b&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Indexer un dossier: hacher et copier les fichiers PDF qu'il contient.</p>
<p>Les copies sont renommées en préfixant le nom de chaque fichier par le
hachage, afin d'éviter les conflits de noms de fichiers issus de dossiers
différents.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>in_dir</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Dossier à traiter, contenant des PDF.</p>
              </div>
            </li>
            <li>
              <b><code>out_dir</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Dossier de sortie, contenant les copies des PDF dont le nom est
précédé par le hachage.</p>
              </div>
            </li>
            <li>
              <b><code>index_csv</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Fichier d'index général des PDF.</p>
              </div>
            </li>
            <li>
              <b><code>new_csv</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Fichier d'index des nouveaux PDF indexés par cette exécution.</p>
              </div>
            </li>
            <li>
              <b><code>recursive</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, parcourt récursivement le dossier in_dir.</p>
              </div>
            </li>
            <li>
              <b><code>digest</code></b>
                  (<code>str, defaults to &#34;blake2b&#34;</code>, default:
                      <code>&#39;blake2b&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Algorithme de hachage à utiliser
<a href="https://docs.python.org/3/library/hashlib.html#hash-algorithms">https://docs.python.org/3/library/hashlib.html#hash-algorithms</a> .</p>
              </div>
            </li>
            <li>
              <b><code>verbose</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, des warnings sont émis à chaque anomalie constatée dans les
métadonnées du PDF.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="extraire-les-metadonnees-des-fichiers-pdf">Extraire les métadonnées des fichiers PDF</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.pdf_info"></a>
  <div class="doc doc-contents first">
  
      <p>Ce module utilise pikepdf.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.pdf_info.get_pdf_info" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_pdf_info</span><span class="p">(</span><span class="n">fp_pdf</span><span class="p">,</span> <span class="n">digest</span><span class="o">=</span><span class="s1">&#39;blake2b&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extraire les informations (dont métadonnées) d'un fichier PDF.</p>
<p>Utilise actuellement pikepdf.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fp_pdf</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Chemin du fichier PDF à traiter.</p>
              </div>
            </li>
            <li>
              <b><code>digest</code></b>
                  (<code>str</code>, default:
                      <code>&#39;blake2b&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Algorithme de hachage à utiliser
<a href="https://docs.python.org/3/library/hashlib.html#hash-algorithms">https://docs.python.org/3/library/hashlib.html#hash-algorithms</a> .</p>
              </div>
            </li>
            <li>
              <b><code>verbose</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, des warnings sont émis à chaque anomalie constatée dans les
métadonnées du PDF.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>pdf_info</code></b>(                <code>dict</code>
)            –
            <div class="doc-md-description">
              <p>Informations (dont métadonnées) du fichier PDF d'entrée</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.preprocess.pdf_info.get_pdf_info_pikepdf" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_pdf_info_pikepdf</span><span class="p">(</span><span class="n">fp_pdf_in</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Renvoie les infos du PDF en utilisant pikepdf.</p>
<p>Les infos incluent un sous-ensemble des métadonnées du PDF.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>fp_pdf_in</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Chemin du fichier PDF à traiter.</p>
              </div>
            </li>
            <li>
              <b><code>verbose</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Si True, des warnings sont émis à chaque anomalie constatée dans les
métadonnées du PDF.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>infos</code></b>(                <code>dict</code>
)            –
            <div class="doc-md-description">
              <p>Dictionnaire contenant les infos du PDF.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="traiter-les-metadonnees-des-fichiers-pdf">Traiter les métadonnées des fichiers PDF</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.process_metadata"></a>
  <div class="doc doc-contents first">
  
      <p>Les traitements permettent de:
* détecter les fichiers doublons,
* déterminer si le PDF est du texte ou image,
* déterminer si le PDF contient des tampons de télétransmission en haut des pages,
* déterminer si le PDF contient une dernière page qui est l'accusé de réception de la télétransmission.</p>
<p>La liste des tiers de transmission agréés pour @ctes est sur
<a href="https://www.collectivites-locales.gouv.fr/sites/default/files/migration/2019_09_13_liste_operateurs_transmission_0.pdf">https://www.collectivites-locales.gouv.fr/sites/default/files/migration/2019_09_13_liste_operateurs_transmission_0.pdf</a> .</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.process_metadata.guess_badocr" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">guess_badocr</span><span class="p">(</span><span class="n">df_meta</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Détermine si le fichier contient une couche OCR de piètre qualité.</p>
<p>Arrive quand le champ "creatortool" vaut "Image Capture Plus".</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Métadonnées des fichiers PDF</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Métadonnées enrichies d'une nouvelle colonne "guess_badocr"</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.preprocess.process_metadata.guess_dernpage_transmission" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">guess_dernpage_transmission</span><span class="p">(</span><span class="n">df_meta</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Détermine si la dernière page est un accusé de réception de télétransmission.</p>
<p>Permet de traiter certains arrêtés recueillis après leur télétransmission.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Métadonnées des fichiers PDF</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Métadonnées enrichies d'une nouvelle colonne "guess_dernpage"</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.preprocess.process_metadata.guess_duplicates_meta" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">guess_duplicates_meta</span><span class="p">(</span><span class="n">df_meta</span><span class="p">,</span> <span class="n">hash_fn</span><span class="o">=</span><span class="s1">&#39;blake2b&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Détermine si les fichiers PDF sont des doublons à partir de leurs métadonnées.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Métadonnées des fichiers PDF</p>
              </div>
            </li>
            <li>
              <b><code>hash_fn</code></b>
                  (<code>str</code>, default:
                      <code>&#39;blake2b&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Nom de la fonction de hachage, doit être un nom de colonne du DataFrame
de métadonnées.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Métadonnées des fichiers PDF, avec des colonnes booléennes "dup_*" indiquant
les fichiers doublons.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.preprocess.process_metadata.guess_pdftext" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">guess_pdftext</span><span class="p">(</span><span class="n">df_meta</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Détermine si le fichier est un PDF texte (ou "numérique natif").</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Métadonnées des fichiers PDF</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Métadonnées enrichies d'une nouvelle colonne "guess_pdftext"</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.preprocess.process_metadata.guess_tampon_transmission" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">guess_tampon_transmission</span><span class="p">(</span><span class="n">df_meta</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Détermine si le haut des pages contient des tampons de transmission électronique.</p>
<p>Permet de traiter certains arrêtés recueillis après leur télétransmission.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Métadonnées des fichiers PDF</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_mmod</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Métadonnées enrichies d'une nouvelle colonne "guess_tampon"</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div><h2 id="charge-le-texte-des-documents-dans-un-dataframe">Charge le texte des documents dans un DataFrame</h2>


<div class="doc doc-object doc-module">



<a id="src.preprocess.separate_pages"></a>
  <div class="doc doc-contents first">
  
      <p>Chaque ligne correspond à une page d'un document.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.preprocess.separate_pages.create_pages_dataframe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_pages_dataframe</span><span class="p">(</span><span class="n">df_meta</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Charger le texte des documents dans un DataFrame.</p>
<p>Une entrée par page de document.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_meta</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Métadonnées des documents.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
<b><code>df_txts</code></b>(                <code><span title="pandas.DataFrame">DataFrame</span></code>
)            –
            <div class="doc-md-description">
              <p>Tableau contenant le texte des documents, séparé par page.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../domain_knowledge/" class="btn btn-neutral float-left" title="Domain Knowledge"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../process/" class="btn btn-neutral float-right" title="Process">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../domain_knowledge/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../process/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
